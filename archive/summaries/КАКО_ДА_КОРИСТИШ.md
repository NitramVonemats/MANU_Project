# –ö–∞–∫–æ –¥–∞ –∫–æ—Ä–∏—Å—Ç–∏—à - Model Comparison Scripts

## –§–∏–∫—Å–∏—Ä–∞–Ω–∞ –≥—Ä–µ—à–∫–∞
‚úÖ –§–∏–∫—Å–∏—Ä–∞–Ω KeyError: 'train_loader' - —Å–µ–≥–∞ —Å–∫—Ä–∏–ø—Ç–æ—Ç –ø—Ä–∞–≤–∏–ª–Ω–æ –∫—Ä–µ–∏—Ä–∞ DataLoaders

---

## 3 –°–∫—Ä–∏–ø—Ç–∏ - 3 –ù–∞—á–∏–Ω–∏

### 1Ô∏è‚É£ Quick Test (2 runs - 5-10 –º–∏–Ω—É—Ç–∏)
–¢–µ—Å—Ç–∏—Ä–∞—ò –¥–∞–ª–∏ —Å√® —Ä–∞–±–æ—Ç–∏ –ø—Ä–µ–¥ –¥–∞ –ø–æ—á–Ω–µ—à —Å–æ full runs.

```bash
cd C:/Users/martinsta/PycharmProjects/MANU_Project
source .venv/Scripts/activate
python model_comparison_quick_test.py 2>&1 | tee quick_test.log
```

**–®—Ç–æ —Ç–µ—Å—Ç–∏—Ä–∞:** 2 –º–æ–¥–µ–ª–∞ (GCN, SAGE) –Ω–∞ 1 –¥–∞—Ç–∞—Å–µ—Ç (Caco2_Wang)
**–í—Ä–µ–º–µ:** ~5-10 –º–∏–Ω—É—Ç–∏
**–¶–µ–ª:** –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ —Å√® —Ä–∞–±–æ—Ç–∏

---

### 2Ô∏è‚É£ Phase 1: Model Selection (35 runs - 2-4 —á–∞—Å–∞)
**–ü–†–ï–ü–û–†–ê–ß–ê–ù–û –∑–∞ –ø–æ—á–µ—Ç–æ–∫!**

–¢–µ—Å—Ç–∏—Ä–∞—ò —Å–∏—Ç–µ 5 –º–æ–¥–µ–ª–∏ –Ω–∞ —Å–∏—Ç–µ 7 –¥–∞—Ç–∞—Å–µ—Ç–∏ —Å–æ —Ñ–∏–∫—Å–∏—Ä–∞–Ω–∏ —Ö–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∏.

```bash
cd C:/Users/martinsta/PycharmProjects/MANU_Project
source .venv/Scripts/activate
python model_comparison_phase1.py 2>&1 | tee phase1.log
```

**–®—Ç–æ —Ç–µ—Å—Ç–∏—Ä–∞:** 5 –º–æ–¥–µ–ª–∞ √ó 7 –¥–∞—Ç–∞—Å–µ—Ç–∏ = 35 runs
**–í—Ä–µ–º–µ:** ~2-4 —á–∞—Å–∞
**–¶–µ–ª:** –û–¥–±–µ—Ä–∏ –Ω–∞—ò–¥–æ–±–∞—Ä GNN –º–æ–¥–µ–ª –∑–∞ —Å–µ–∫–æ—ò –¥–∞—Ç–∞—Å–µ—Ç

**–†–µ–∑—É–ª—Ç–∞—Ç–∏:**
- `reports/model_comparison_phase1/<timestamp>/results.json`
- `reports/model_comparison_phase1/<timestamp>/summary.csv`
- `reports/model_comparison_phase1/<timestamp>/best_models_per_dataset.csv` ‚≠ê

---

### 3Ô∏è‚É£ Full Grid Search (5,670 runs - –Ω–µ–∫–æ–ª–∫—É –¥–µ–Ω–∞)
**–ù–ê–ü–†–ï–î–ù–û - –∫–æ—Ä–∏—Å—Ç–∏ –≥–æ —Å–∞–º–æ –ø–æ—Å–ª–µ Phase 1!**

Full hyperparameter grid search –Ω–∞ —Å–∏—Ç–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏.

```bash
cd C:/Users/martinsta/PycharmProjects/MANU_Project
source .venv/Scripts/activate
python model_comparison.py 2>&1 | tee full_grid_search.log
```

**–®—Ç–æ —Ç–µ—Å—Ç–∏—Ä–∞:**
5 –º–æ–¥–µ–ª–∞ √ó 7 –¥–∞—Ç–∞—Å–µ—Ç–∏ √ó 3 layers √ó 3 hidden √ó 2 LR √ó 3 dropout √ó 3 heads = **5,670 runs**

**–í—Ä–µ–º–µ:**
- –ë–µ–∑ GPU: ~10-20 –¥–µ–Ω–∞
- –°–æ GPU: ~1-3 –¥–µ–Ω–∞

**–¶–µ–ª:** –ù–∞—ò–¥–∏ –Ω–∞—ò–¥–æ–±—Ä–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏—ò–∞ –Ω–∞ model + hyperparameters –∑–∞ —Å–µ–∫–æ—ò –¥–∞—Ç–∞—Å–µ—Ç

---

## –ü—Ä–µ–ø–æ—Ä–∞—á–∞–Ω Workflow

### –î–µ–Ω 1: Quick Test
```bash
python model_comparison_quick_test.py
```
- –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ —Å–∫—Ä–∏–ø—Ç–æ—Ç —Ä–∞–±–æ—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ —Å–µ —Ä–∞–∑—É–º–Ω–∏
- –ê–∫–æ –∏–º–∞ –≥—Ä–µ—à–∫–∏, —Ñ–∏–∫—Å–∏—Ä–∞—ò –≥–∏ –ø—Ä–µ–¥ –¥–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—à

### –î–µ–Ω 2-3: Phase 1 (Model Selection)
```bash
python model_comparison_phase1.py
```
- –ü—É—à—Ç–∏ –≥–æ –ø—Ä–µ–∫—É –Ω–æ—ú (2-4 —á–∞—Å–∞)
- –ù–∞—É—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏ `best_models_per_dataset.csv`
- –å–µ –∑–Ω–∞–µ—à –∫–æ—ò GNN –º–æ–¥–µ–ª –µ –Ω–∞—ò–¥–æ–±–∞—Ä –∑–∞ —Å–µ–∫–æ—ò –¥–∞—Ç–∞—Å–µ—Ç

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—Ç–∞—Ç:**
```
Dataset                      Best_Model  Test_RMSE  Test_R2
Caco2_Wang                   SAGE        0.003249   0.2527
Half_Life_Obach              GIN         21.301     0.0363
Clearance_Hepatocyte_AZ      GAT         50.968     0.1371
Clearance_Microsome_AZ       GINE        42.388    -0.0057
tox21                        GCN         -          0.8234 (AUC)
herg                         GAT         -          0.7891 (AUC)
clintox                      SAGE        -          0.8567 (AUC)
```

### –î–µ–Ω 4+: Phase 2 - HPO –∑–∞ –Ω–∞—ò–¥–æ–±—Ä–∏—Ç–µ –º–æ–¥–µ–ª–∏
–ü–æ —à—Ç–æ —ú–µ –∑–Ω–∞–µ—à –∫–æ—ò –º–æ–¥–µ–ª –µ –Ω–∞—ò–¥–æ–±–∞—Ä –∑–∞ —Å–µ–∫–æ—ò –¥–∞—Ç–∞—Å–µ—Ç, —Ç–µ—Å—Ç–∏—Ä–∞—ò hyperparameters.

–ü—Ä–∏–º–µ—Ä: –ê–∫–æ SAGE –µ –Ω–∞—ò–¥–æ–±–∞—Ä –∑–∞ Caco2_Wang:

```python
# –ö—Ä–µ–∏—Ä–∞—ò model_comparison_phase2_caco2.py
from model_comparison import run_model_comparison

results = run_model_comparison(
    models=["SAGE"],  # —Å–∞–º–æ –Ω–∞—ò–¥–æ–±—Ä–∏–æ—Ç –º–æ–¥–µ–ª
    datasets=["Caco2_Wang"],  # –µ–¥–µ–Ω –¥–∞—Ç–∞—Å–µ—Ç

    # Grid search –Ω–∞ —Ö–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∏
    num_layers_list=[3, 5, 7, 9],
    hidden_dims_list=[64, 128, 256],
    learning_rates=[1e-2, 1e-3, 1e-4],
    dropouts=[0.0, 0.3, 0.5],
    head_dims_list=[(256, 128, 64), (128, 64), (64, 32)],

    epochs=100,
    patience=20,
    device="auto",
    seed=42,
    save_dir="reports/phase2_caco2_sage",
)
```

Runs: 1 √ó 1 √ó 4 √ó 3 √ó 3 √ó 3 √ó 3 = **324 runs** (~6-12 —á–∞—Å–∞)

–ü–æ–≤—Ç–æ—Ä–∏ –∑–∞ —Å–µ–∫–æ—ò –¥–∞—Ç–∞—Å–µ—Ç —Å–æ –Ω–µ–≥–æ–≤–∏–æ—Ç –Ω–∞—ò–¥–æ–±–∞—Ä –º–æ–¥–µ–ª.

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ä–∞—ö–µ –Ω–∞ Progress

### –°–ª–µ–¥–∏ real-time output:
```bash
tail -f phase1.log
```

### –ü—Ä–æ–≤–µ—Ä–∏ –∫–æ–ª–∫—É runs —Å–µ –∑–∞–≤—Ä—à–µ–Ω–∏:
```bash
# –û—Ç–≤–æ—Ä–∏ reports/model_comparison_phase1/<timestamp>/results.json
# –ë—Ä–æ—ò –Ω–∞ entries = –±—Ä–æ—ò –Ω–∞ –∑–∞–≤—Ä—à–µ–Ω–∏ runs
```

### –ü—Ä–µ–∫–∏–Ω–∏ –≥–æ —Å–∫—Ä–∏–ø—Ç–æ—Ç:
```bash
Ctrl + C
```

**–í–∞–∂–Ω–æ:** –†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ —Å–µ –∑–∞—á—É–≤—É–≤–∞–∞—Ç –ø–æ—Å–ª–µ —Å–µ–∫–æ—ò run, —Ç–∞–∫–∞ —à—Ç–æ –º–æ–∂–µ—à –¥–∞ –≥–æ –ø—Ä–µ–∫–∏–Ω–µ—à –∏ –¥–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—à –ø–æ–¥–æ—Ü–Ω–∞ (–∏–∞–∫–æ currently –Ω–µ–º–∞ resume —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç).

---

## –®—Ç–æ –∞–∫–æ –Ω–µ—à—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∏?

### –ì—Ä–µ—à–∫–∞: ModuleNotFoundError
```bash
pip install torch torch-geometric PyTDC pandas numpy scikit-learn
```

### –ì—Ä–µ—à–∫–∞: CUDA out of memory
–°–º–∞–ª–∏ –≥–æ batch size –≤–æ —Å–∫—Ä–∏–ø—Ç–æ—Ç:
```python
# model_comparison_phase1.py
# –ù–∞ –∫—Ä–∞—ò–æ—Ç, –¥–æ–¥–∞—ò:
config = OptimizedGNNConfig(
    batch_train=16,  # –Ω–∞–º–µ—Å—Ç–æ 32
    batch_eval=32,   # –Ω–∞–º–µ—Å—Ç–æ 64
)
```

### –ì—Ä–µ—à–∫–∞: Dataset loading failed
–ü—Ä–æ–≤–µ—Ä–∏ TDC:
```bash
pip install --upgrade PyTDC
```

### Training e –ø—Ä–µ–º–Ω–æ–≥—É –¥–æ–ª–≥–æ
–°–º–∞–ª–∏ epochs:
```python
epochs=50,   # –Ω–∞–º–µ—Å—Ç–æ 100
patience=10, # –Ω–∞–º–µ—Å—Ç–æ 20
```

---

## –°–ª–µ–¥–Ω–∏ –ß–µ–∫–æ—Ä–∏

–ü–æ Phase 1:
1. ‚úÖ –å–µ –∏–º–∞—à `best_models_per_dataset.csv` - –Ω–∞—ò–¥–æ–±–∞—Ä –º–æ–¥–µ–ª –∑–∞ —Å–µ–∫–æ—ò –¥–∞—Ç–∞—Å–µ—Ç
2. üìä –ü—Ä–æ–¥–æ–ª–∂–∏ —Å–æ Phase 2: HPO –Ω–∞ –Ω–∞—ò–¥–æ–±—Ä–∏—Ç–µ –º–æ–¥–µ–ª–∏ (–∫–∞–∫–æ –≥–æ—Ä–Ω–∏–æ—Ç –ø—Ä–∏–º–µ—Ä)
3. üî¨ –ù–∞–ø—Ä–∞–≤–∏ ablation studies (—Ç–µ—Å—Ç–∏—Ä–∞—ò impact –Ω–∞ —Å–µ–∫–æ—ò —Ö–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç–∞—Ä)
4. üìà –ö—Ä–µ–∏—Ä–∞—ò –≤–∏–∑—É–µ–ª–∏–∑–∞—Ü–∏–∏ (plots, heatmaps)
5. üìä –°—Ç–∞—Ç–∏—Å—Ç–∏—á–∫–∏ —Ç–µ—Å—Ç–æ–≤–∏ (Friedman, Wilcoxon)

---

## –ü—Ä–∞—à–∞—ö–∞?

–û—Ç–≤–æ—Ä–∏ `MODEL_COMPARISON_README.md` –∑–∞ –¥–µ—Ç–∞–ª–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—ò–∞.

–°√® –µ –ø–æ–¥–≥–æ—Ç–≤–µ–Ω–æ! üöÄ

**–ó–∞–ø–æ—á–Ω–∏ —Å–æ:**
```bash
python model_comparison_quick_test.py
```
