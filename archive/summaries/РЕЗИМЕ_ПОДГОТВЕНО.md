# üìã –†–ï–ó–ò–ú–ï - –°√® —à—Ç–æ –µ –ø–æ–¥–≥–æ—Ç–≤–µ–Ω–æ

## ‚úÖ –ó–∞–≤—Ä—à–µ–Ω–∏ –∑–∞–¥–∞—á–∏:

### 1. GNN –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∏ ‚úì
**–§–∞—ò–ª:** `adme_gnn/models/gnn.py`

–ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∏ 5 GNN –º–æ–¥–µ–ª–∏:
- ‚úÖ **GCN** (Graph Convolutional Network)
- ‚úÖ **GAT** (Graph Attention Network) - —Å–æ multi-head attention
- ‚úÖ **GraphSAGE** (Sampling and Aggregation)
- ‚úÖ **GIN** (Graph Isomorphism Network) - —Å–æ MLP
- ‚úÖ **GINE** (GIN with Edge features)

**–ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- Residual connections
- Batch normalization
- Configurable dropout
- Edge feature support (GINE)
- Multi-head attention (GAT)

---

### 2. Dataset Support ‚úì
**–§–∞—ò–ª:** `optimized_gnn.py`

- ‚úÖ 4 ADME –¥–∞—Ç–∞—Å–µ—Ç–∏ (regression)
  - Caco2_Wang
  - Half_Life_Obach
  - Clearance_Hepatocyte_AZ
  - Clearance_Microsome_AZ

- ‚úÖ 3 Toxicity –¥–∞—Ç–∞—Å–µ—Ç–∏ (classification)
  - tox21 (label: 'NR-AR')
  - herg (single-task)
  - clintox (label: 'CT_TOX')

**–§–∏–∫—Å–∏—Ä–∞–Ω–∏:**
- ‚úÖ Label selection –∑–∞ multi-task Tox –¥–∞—Ç–∞—Å–µ—Ç–∏
- ‚úÖ Classification metrics (AUC-ROC, F1, Accuracy)
- ‚úÖ Regression metrics (RMSE, MAE, R¬≤)

---

### 3. Model Comparison Framework ‚úì
**–§–∞—ò–ª:** `model_comparison.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç–∏:**
- ‚úÖ Grid search –Ω–∞ —Ö–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∏
- ‚úÖ Automatic result saving (JSON + CSV)
- ‚úÖ Best model selection per dataset
- ‚úÖ Progress tracking
- ‚úÖ Error handling –∏ retry logic

**–•–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —à—Ç–æ —Å–µ —Ç–µ—Å—Ç–∏—Ä–∞–∞—Ç:**
- –ë—Ä–æ—ò –Ω–∞ layers: [3, 5, 7]
- Hidden dimensions: [64, 128, 256]
- Learning rate: [1e-3, 1e-4]
- Dropout: [0.0, 0.3, 0.5]
- Head dimensions: [(256,128,64), (128,64), (64,32)]

**–†–µ–∑—É–ª—Ç–∞—Ç–∏:**
- `results.json` - –ö–æ–º–ø–ª–µ—Ç–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
- `summary.csv` - –¢–∞–±–µ–ª–∞ —Å–æ —Å√®
- `best_models_per_dataset.csv` - –ù–∞—ò–¥–æ–±—Ä–∏ –º–æ–¥–µ–ª–∏

---

### 4. Ready-to-Use Scripts ‚úì

#### üöÄ Quick Test (2 runs - 5-10 min)
**–§–∞—ò–ª:** `model_comparison_quick_test.py`
```bash
python model_comparison_quick_test.py
```

#### üìä Phase 1: Model Selection (35 runs - 2-4 —á–∞—Å–∞)
**–§–∞—ò–ª:** `model_comparison_phase1.py`
```bash
python model_comparison_phase1.py
```

#### üî¨ Full Grid Search (5,670 runs - –¥–µ–Ω–∞)
**–§–∞—ò–ª:** `model_comparison.py`
```bash
python model_comparison.py
```

---

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—ò–∞ ‚úì

#### üìò –ú–∞–∫–µ–¥–æ–Ω—Å–∫–∏ (–µ–¥–Ω–æ—Å—Ç–∞–≤–Ω–æ)
**–§–∞—ò–ª:** `–ö–ê–ö–û_–î–ê_–ö–û–†–ò–°–¢–ò–®.md`
- –ö–∞–∫–æ –¥–∞ –ø–æ—á–Ω–µ—à
- 3 —Å–∫—Ä–∏–ø—Ç–∏ –æ–±—ò–∞—Å–Ω–µ—Ç–∏
- –ü—Ä–µ–ø–æ—Ä–∞—á–∞–Ω workflow
- Troubleshooting

#### üìó –ê–Ω–≥–ª–∏—Å–∫–∏ (–¥–µ—Ç–∞–ª–Ω–æ)
**–§–∞—ò–ª:** `MODEL_COMPARISON_README.md`
- Technical details
- All hyperparameter options
- Examples –∑–∞ —Å–µ–∫–æ—ò scenario
- Advanced usage

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–æ—Ç

```
MANU_Project/
‚îú‚îÄ‚îÄ adme_gnn/
‚îÇ   ‚îî‚îÄ‚îÄ models/
‚îÇ       ‚îî‚îÄ‚îÄ gnn.py                    ‚úÖ 5 GNN –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ model_comparison.py                ‚úÖ Main comparison framework
‚îú‚îÄ‚îÄ model_comparison_quick_test.py     ‚úÖ Quick test (2 runs)
‚îú‚îÄ‚îÄ model_comparison_phase1.py         ‚úÖ Phase 1 (35 runs)
‚îú‚îÄ‚îÄ optimized_gnn.py                   ‚úÖ Dataset loading + base code
‚îú‚îÄ‚îÄ –ö–ê–ö–û_–î–ê_–ö–û–†–ò–°–¢–ò–®.md                ‚úÖ –ú–∞–∫–µ–¥–æ–Ω—Å–∫–∏ guide
‚îú‚îÄ‚îÄ MODEL_COMPARISON_README.md         ‚úÖ –ê–Ω–≥–ª–∏—Å–∫–∏ documentation
‚îî‚îÄ‚îÄ –†–ï–ó–ò–ú–ï_–ü–û–î–ì–û–¢–í–ï–ù–û.md               ‚úÖ –û–≤–æ—ò —Ñ–∞—ò–ª
```

---

## üö¶ –ö–∞–∫–æ –¥–∞ –ø–æ—á–Ω–µ—à:

### –ß–µ–∫–æ—Ä 1: Quick Test (–ó–ê–î–û–õ–ñ–ò–¢–ï–õ–ù–û!)
```bash
cd C:/Users/martinsta/PycharmProjects/MANU_Project
source .venv/Scripts/activate
python model_comparison_quick_test.py
```

**–¢—Ä–∞–µ—ö–µ:** 5-10 –º–∏–Ω—É—Ç–∏
**–¶–µ–ª:** –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ —Å√® —Ä–∞–±–æ—Ç–∏

### –ß–µ–∫–æ—Ä 2: Phase 1 - Model Selection
```bash
python model_comparison_phase1.py 2>&1 | tee phase1.log
```

**–¢—Ä–∞–µ—ö–µ:** 2-4 —á–∞—Å–∞
**–¶–µ–ª:** –ù–∞—ò–¥–∏ –Ω–∞—ò–¥–æ–±–∞—Ä GNN –º–æ–¥–µ–ª –∑–∞ —Å–µ–∫–æ—ò –¥–∞—Ç–∞—Å–µ—Ç

### –ß–µ–∫–æ—Ä 3: –ê–Ω–∞–ª–∏–∑–∏—Ä–∞—ò —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
```bash
# –û—Ç–≤–æ—Ä–∏:
reports/model_comparison_phase1/<timestamp>/best_models_per_dataset.csv
```

---

## üìä –û—á–µ–∫—É–≤–∞–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ (Phase 1)

–ü–æ 35 runs —ú–µ –¥–æ–±–∏–µ—à —Ç–∞–±–µ–ª–∞ –∫–∞–∫–æ:

```
Dataset                      Best_Model  Layers  Hidden  LR      Test_RMSE  Test_R2
Caco2_Wang                   SAGE        5       128     0.001   0.003249   0.2527
Half_Life_Obach              GIN         5       128     0.001   21.301     0.0363
Clearance_Hepatocyte_AZ      GAT         5       128     0.001   50.968     0.1371
Clearance_Microsome_AZ       GINE        5       128     0.001   42.388    -0.0057

Dataset                      Best_Model  Layers  Hidden  LR      Test_AUC   Test_F1
tox21                        GCN         5       128     0.001   0.823      0.756
herg                         GAT         5       128     0.001   0.789      0.712
clintox                      SAGE        5       128     0.001   0.857      0.801
```

---

## üéØ –°–ª–µ–¥–Ω–∏ —á–µ–∫–æ—Ä–∏ (Phase 2+)

### Phase 2: HPO –∑–∞ –Ω–∞—ò–¥–æ–±—Ä–∏—Ç–µ –º–æ–¥–µ–ª–∏
–ü–æ Phase 1, –∑–∞ —Å–µ–∫–æ—ò –¥–∞—Ç–∞—Å–µ—Ç:
1. –ó–µ–º–∏ –≥–æ –Ω–∞—ò–¥–æ–±—Ä–∏–æ—Ç –º–æ–¥–µ–ª (–æ–¥ `best_models_per_dataset.csv`)
2. –ù–∞–ø—Ä–∞–≤–∏ grid search –Ω–∞ —Ö–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞ —Ç–æ—ò –º–æ–¥–µ–ª
3. –ù–∞—ò–¥–∏ –æ–ø—Ç–∏–º–∞–ª–Ω–∏ —Ö–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∏

**–ü—Ä–∏–º–µ—Ä:** –ê–∫–æ SAGE –µ –Ω–∞—ò–¥–æ–±–∞—Ä –∑–∞ Caco2_Wang:
- –¢–µ—Å—Ç–∏—Ä–∞—ò SAGE —Å–æ —Ä–∞–∑–ª–∏—á–Ω–∏ layers, hidden dims, dropout, –∏—Ç–Ω.
- ~300-500 runs –ø–æ –¥–∞—Ç–∞—Å–µ—Ç

### Phase 3: Ablation Studies
–¢–µ—Å—Ç–∏—Ä–∞—ò impact –Ω–∞ —Å–µ–∫–æ—ò —Ö–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç–∞—Ä –æ–¥–¥–µ–ª–Ω–æ:
- **Layers:** –ö–∞–∫–æ –±—Ä–æ—ò–æ—Ç –Ω–∞ layers –≤–ª–∏—ò–∞–µ –Ω–∞ performance?
- **Hidden dims:** –ö–æ—ò–∞ hidden dimension –µ –Ω–∞—ò–¥–æ–±—Ä–∞?
- **Learning rate:** –ö–æ—ò LR –µ –æ–ø—Ç–∏–º–∞–ª–µ–Ω?
- **Dropout:** –î–∞–ª–∏ dropout –ø–æ–º–∞–≥–∞?

### Phase 4: Visualization & Statistics
- Heatmaps (model √ó dataset performance)
- Line plots (hyperparameter impact)
- Statistical tests (Friedman, Wilcoxon)
- Publication-ready figures

---

## ‚ö†Ô∏è –í–∞–∂–Ω–∏ –ó–∞–±–µ–ª–µ—à–∫–∏

### 1. –í—Ä–µ–º–∏—ö–∞
- Quick test: 5-10 –º–∏–Ω
- Phase 1 (35 runs): 2-4 —á–∞—Å–∞
- Phase 2 (per dataset): 4-8 —á–∞—Å–∞
- Full grid search (5,670): 10-20 –¥–µ–Ω–∞ (CPU) / 1-3 –¥–µ–Ω–∞ (GPU)

### 2. Checkpoint
–†–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ —Å–µ –∞–≤—Ç–æ–º–∞—Ç—Å–∫–∏ –∑–∞—á—É–≤—É–≤–∞–∞—Ç –ø–æ—Å–ª–µ —Å–µ–∫–æ—ò run –≤–æ `results.json`.

### 3. Resume (TODO)
–°√® —É—à—Ç–µ –Ω–µ–º–∞ resume —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç. –ê–∫–æ –ø—Ä–µ–∫–∏–Ω–µ—à, –º–æ—Ä–∞ –¥–∞ –ø–æ—á–Ω–µ—à –æ–¥–Ω–æ–≤–æ.

### 4. –ü–∞—Ä–∞–ª–µ–ª–∏–∑–∞—Ü–∏—ò–∞ (TODO)
–°√® —É—à—Ç–µ –Ω–µ–º–∞ –ø–∞—Ä–∞–ª–µ–ª–∏–∑–∞—Ü–∏—ò–∞. Runs —Å–µ sequential.

---

## üêõ –§–∏–∫—Å–∏—Ä–∞–Ω–∏ –ì—Ä–µ—à–∫–∏

- ‚úÖ KeyError: 'train_loader' - —Ñ–∏–∫—Å–∏—Ä–∞–Ω–æ
- ‚úÖ UnicodeEncodeError (emoji) - —Ñ–∏–∫—Å–∏—Ä–∞–Ω–æ
- ‚úÖ Tox dataset label selection - —Ñ–∏–∫—Å–∏—Ä–∞–Ω–æ
- ‚úÖ Classification support - –¥–æ–¥–∞–¥–µ–Ω–æ

---

## üìû –ê–∫–æ –∏–º–∞—à –ø—Ä–∞—à–∞—ö–∞

1. –ü—Ä–æ—á–∏—Ç–∞—ò `–ö–ê–ö–û_–î–ê_–ö–û–†–ò–°–¢–ò–®.md` (–ú–∞–∫–µ–¥–æ–Ω—Å–∫–∏)
2. –ü—Ä–æ—á–∏—Ç–∞—ò `MODEL_COMPARISON_README.md` (–ê–Ω–≥–ª–∏—Å–∫–∏ - –¥–µ—Ç–∞–ª–Ω–æ)
3. –ü—Ä–æ–≤–µ—Ä–∏ `FINAL_REPORT.md` –∑–∞ pretrained models

---

## ‚ú® Summary

**–°√® –µ –ø–æ–¥–≥–æ—Ç–≤–µ–Ω–æ!** üéâ

–ó–∞–ø–æ—á–Ω–∏ —Å–æ:
```bash
python model_comparison_quick_test.py
```

–ü–∞ –ø—Ä–æ–¥–æ–ª–∂–∏ —Å–æ:
```bash
python model_comparison_phase1.py
```

–°—Ä–µ—ú–Ω–æ! üöÄ
